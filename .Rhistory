breaks = seq(from=18, to=29, by=1),
col='gray40', lwd=0.5, lty=2 ) +
geom_text_contour(data=malla,
aes(x=Var1,y=Var2,
z=sigma0,
label=..level..),
inherit.aes = FALSE,
label.placer = label_placer_n(
n = 2
) ) +
scale_x_continuous(expand=c(0,0), limits=c(34,36))+
scale_y_continuous(expand=c(0,0))+
xlab(label = 'Salinidad Absoluta (UPS)') +
ylab(label = 'Temperatura Conservativa (°C)') +
guides(colour = guide_legend( title = c('Profundidad (m)','Fuente')) ) +
theme_bw() + theme( axis.text = element_text(size=12),
axis.title = element_text(size=14))
plot(pp)
df1 <- df[sample(nrow(df),replace = FALSE,size = 3000  ),]
############
windows(width=700, height=600)
pp <- ggplot(data = df1,
aes(x= sal,
y=tem,
col = pro_cat,
shape = fuente)  ) +
geom_point( size=3 ) +
scale_shape_manual(values = c( 3, 6)) +
geom_contour(data=malla,
aes(x=Var1, y=Var2, z=sigma0),
inherit.aes = FALSE,
na.rm = TRUE,
breaks = seq(from=18, to=29, by=1),
col='gray40', lwd=0.5, lty=2 ) +
geom_text_contour(data=malla,
aes(x=Var1,y=Var2,
z=sigma0,
label=..level..),
inherit.aes = FALSE,
label.placer = label_placer_n(
n = 2
) ) +
scale_x_continuous(expand=c(0,0), limits=c(34,36))+
scale_y_continuous(expand=c(0,0))+
xlab(label = 'Salinidad Absoluta (UPS)') +
ylab(label = 'Temperatura Conservativa (°C)') +
guides(colour = guide_legend( title = c('Profundidad (m)','Fuente')) ) +
theme_bw() + theme( axis.text = element_text(size=12),
axis.title = element_text(size=14))
plot(pp)
############
windows(width=700, height=600)
pp <- ggplot(data = df1,
aes(x= sal,
y=tem,
col = pro_cat,
shape = fuente)  ) +
geom_point( size=3 ) +
scale_shape_manual(values = c( 6, 3)) +
geom_contour(data=malla,
aes(x=Var1, y=Var2, z=sigma0),
inherit.aes = FALSE,
na.rm = TRUE,
breaks = seq(from=18, to=29, by=1),
col='gray40', lwd=0.5, lty=2 ) +
geom_text_contour(data=malla,
aes(x=Var1,y=Var2,
z=sigma0,
label=..level..),
inherit.aes = FALSE,
label.placer = label_placer_n(
n = 2
) ) +
scale_x_continuous(expand=c(0,0), limits=c(34,36))+
scale_y_continuous(expand=c(0,0))+
xlab(label = 'Salinidad Absoluta (UPS)') +
ylab(label = 'Temperatura Conservativa (°C)') +
guides(colour = guide_legend( title = c('Profundidad (m)','Fuente')) ) +
theme_bw() + theme( axis.text = element_text(size=12),
axis.title = element_text(size=14))
plot(pp)
source('E:/programasR/perfiles_argo_dhn.R', encoding = 'UTF-8')
source('E:/programasR/perfiles_argo_dhn.R', encoding = 'UTF-8')
df1 <- df[sample(nrow(df),replace = FALSE,size = 5000  ),]
############
windows(width=700, height=600)
pp <- ggplot(data = df1,
aes(x= sal,
y=tem,
col = pro_cat,
shape = fuente)  ) +
geom_point( size=3 ) +
scale_shape_manual(values = c( 6, 3)) +
geom_contour(data=malla,
aes(x=Var1, y=Var2, z=sigma0),
inherit.aes = FALSE,
na.rm = TRUE,
breaks = seq(from=18, to=29, by=1),
col='gray40', lwd=0.5, lty=2 ) +
geom_text_contour(data=malla,
aes(x=Var1,y=Var2,
z=sigma0,
label=..level..),
inherit.aes = FALSE,
label.placer = label_placer_n(
n = 2
) ) +
scale_x_continuous(expand=c(0,0), limits=c(34,36))+
scale_y_continuous(expand=c(0,0))+
xlab(label = 'Salinidad Absoluta (UPS)') +
ylab(label = 'Temperatura Conservativa (°C)') +
guides(colour = guide_legend( title = c('Profundidad (m)','Fuente')) ) +
theme_bw() + theme( axis.text = element_text(size=12),
axis.title = element_text(size=14))
plot(pp)
#############
df1 <- df[sample(nrow(df),replace = FALSE,size = 5000  ),]
windows(width=700, height=600)
pp <- ggplot(data = df1,
aes(x= sal,
y=tem,
col = pro_cat,
shape = fuente)  ) +
geom_point( size=3 ) +
scale_shape_manual(values = c( 6, 3)) +
geom_contour(data=malla,
aes(x=Var1, y=Var2, z=sigma0),
inherit.aes = FALSE,
na.rm = TRUE,
breaks = seq(from=18, to=29, by=1),
col='gray40', lwd=0.5, lty=2 ) +
geom_text_contour(data=malla,
aes(x=Var1,y=Var2,
z=sigma0,
label=..level..),
inherit.aes = FALSE,
label.placer = label_placer_n(
n = 2
) ) +
scale_x_continuous(expand=c(0,0), limits=c(34,36))+
scale_y_continuous(expand=c(0,0))+
xlab(label = 'Salinidad Absoluta (UPS)') +
ylab(label = 'Temperatura Conservativa (°C)') +
guides(colour = guide_legend( title = c('Profundidad (m)','Fuente')) ) +
theme_bw() + theme( axis.text = element_text(size=12),
axis.title = element_text(size=14))
plot(pp)
#############
df1 <- df[sample(nrow(df),replace = FALSE,size = 5000  ),]
windows(width=700, height=600)
pp <- ggplot(data = df1,
aes(x= sal,
y=tem,
col = pro_cat,
shape = fuente)  ) +
geom_point( size=3 ) +
scale_shape_manual(values = c( 6, 3)) +
geom_contour(data=malla,
aes(x=Var1, y=Var2, z=sigma0),
inherit.aes = FALSE,
na.rm = TRUE,
breaks = seq(from=18, to=29, by=1),
col='gray40', lwd=0.5, lty=2 ) +
geom_text_contour(data=malla,
aes(x=Var1,y=Var2,
z=sigma0,
label=..level..),
inherit.aes = FALSE,
label.placer = label_placer_n(
n = 2
) ) +
scale_x_continuous(expand=c(0,0), limits=c(34,36))+
scale_y_continuous(expand=c(0,0))+
xlab(label = 'Salinidad Absoluta (UPS)') +
ylab(label = 'Temperatura Conservativa (°C)') +
guides(colour = guide_legend( title = c('Profundidad (m)','Fuente')) ) +
theme_bw() + theme( axis.text = element_text(size=12),
axis.title = element_text(size=14))
plot(pp)
install.packages("xlsx")
cat('\014')
rm(list=ls())
library(tidyverse)
library(openxlsx)
graphics.off()
carpeta <- 'E:/consultas/carol/iso2021/'
carpeta <- 'E:/consultas/carol/iso2021/'
lugar <- 'Callao nmpr2 2022'
lista <- list.files(pat = carpeta,
pattern = '\\.xls$',
full.names = TRUE)
lista
lista <- list.files(pat = carpeta,
pattern = '.+\\.xls$',
full.names = TRUE)
lista <- list.files(pat = carpeta,
pattern = '.+\\.xlsx$',
full.names = TRUE)
lista <- list.files(pat = carpeta,
pattern = '.+\\xlsx$',
full.names = TRUE)
lista <- list.files(pat = carpeta,
pattern = '.+\\xlsx',
full.names = TRUE)
lista <- list.files(pat = carpeta,
pattern = '.+xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+xlsx$',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+\\.xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
full.names = TRUE)
lista
lista <- list.files(path = carpeta,
pattern = '.+\\.xlsx$',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+\\.xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = 'xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+\\.xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '\\.xlsx',
full.names = TRUE)
carpeta <- 'E:/consultas/carol/iso2021/2021/'
lista <- list.files(path = carpeta,
pattern = '\\.xlsx',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '\\.xlsx$',
full.names = TRUE)
lista <- list.files(path = carpeta,
pattern = '.+\\.xlsx$',
full.names = TRUE)
lista
clases <- c('integer','integer','character',rep('numeric',times=13))
#####
datos1 <- openxlsx::read.xlsx(file=lista[[1]],sheetIndex = 1,colClasses = clases) # NMPR
datos1 <- openxlsx::read.xlsx(xlsxFile = lista[[1]], sheet = 1, startRow = 2 ) # NMPR
View(datos1)
datos1 <- openxlsx::read.xlsx(xlsxFile = lista[[1]], sheet = 1, colNames=TRUE ) # NMPR
View(datos1)
datos2 <- openxlsx::read.xlsx(xlsxFile = lista[[2]], sheet = 1, colNames=TRUE) # NOAA
datos3 <- openxlsx::read.xlsx(xlsxFile = lista[[3]], sheet = 1, colNames=TRUE) # TH
source('E:/programasR/mareaISO2019.R')
cat('\014')
rm(list=ls())
library(tidyverse)
library(openxlsx)
graphics.off()
carpeta <- 'E:/consultas/carol/iso2021/2021/'
lugar <- 'Talara'
lista <- list.files(path = carpeta,
pattern = '.+\\.xlsx$',
full.names = TRUE)
clases <- c('integer','integer','character',rep('numeric',times=13))
datos1 <- openxlsx::read.xlsx(xlsxFile = lista[[1]], sheet = 1, colNames=TRUE ) # NMPR
datos2 <- openxlsx::read.xlsx(xlsxFile = lista[[2]], sheet = 1, colNames=TRUE) # NOAA
datos3 <- openxlsx::read.xlsx(xlsxFile = lista[[3]], sheet = 1, colNames=TRUE) # TH
dif1 <- datos1 - datos3[-368,]
datos1
View(datos2)
View(datos1)
View(datos3)
tail(datos1)
tail(datos2)
tail(datos3)
datos2 <- openxlsx::read.xlsx(xlsxFile = lista[[2]], sheet = 1, colNames=TRUE) # NOAA
dif1 <- datos1 - datos3[-368,]
dif1 <- datos1 - datos3
dif1 <- datos1 - datos3
datos1 <- datos1[,-c(1:3)]
datos2 <- datos2[,-c(1:3)]
datos3 <- datos3[,-c(1:3)]
dif1 <- datos1 - datos3
dif2 <- datos1 - datos2
dif12 <- c(dif2[,4],dif2[,7],dif2[,10],dif2[,13])
dif1
dif12 <- c(dif2[,4],dif2[,7],dif2[,9],dif2[,12])
dif13 <- c(dif1[,4],dif1[,7],dif1[,9],dif1[,12])
diferencias <- data.frame( diferencias = c(dif12,dif13),
modelo = c(rep('Ttide',times=length(dif12)),
rep('THarmonics',times=length(dif13))))
##########
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(y=diferencias,x=modelo,fill=modelo))
pp <- pp + stat_boxplot(geom = 'errorbar',width=0.2) + geom_boxplot()
pp <- pp + scale_y_continuous(breaks = seq(from=-5,to=5,by=0.5),limits = c(-5,5))
pp <- pp + labs(title='Diferencias con el modelo NMPR',
y=expression(Delta*H~"(cm)"),x='Modelos')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
plot(pp)
##########
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(y=diferencias,x=modelo,fill=modelo))
pp <- pp + stat_boxplot(geom = 'errorbar',width=0.2) + geom_boxplot()
pp <- pp + scale_y_continuous(breaks = seq(from=-5,to=5,by=0.5),limits = c(-5,5))
pp <- pp + labs(title='Diferencias con el modelo NMPR',
y=expression(Delta*H~"(cm)"),x='Modelos')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
plot(pp)
#######################
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 20)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
#######################
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 20)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
###########
dif12 <- 60*(as.numeric(datos1$HOR1) - as.numeric(datos2$HOR1)) +
(as.numeric(datos1$MIN1) - as.numeric(datos2$MIN1))
dif13 <- 60*(as.numeric(datos1$HOR1) - as.numeric(datos3$HOR1[-368])) +
(as.numeric(datos1$MIN1) - as.numeric(datos3$MIN1))
dif23 <- 60*(as.numeric(datos2$HOR1) - as.numeric(datos3$HOR1)) +
(as.numeric(datos2$MIN1) - as.numeric(datos3$MIN1))
################################
diferencias <- data.frame( diferencias = c(dif12,dif13),
modelo = c(rep('Ttide',times=length(dif12)),
rep('THarmonics',times=length(dif13))))
##############################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(y=diferencias,x=modelo,fill=modelo))
pp <- pp + stat_boxplot(geom = 'errorbar',width=0.2) + geom_boxplot()
pp <- pp + scale_y_continuous(breaks = seq(from=-5,to=5,by=0.5),limits = c(-5,5))
pp <- pp+ labs(title='Diferencias en tiempo')
pp <- pp + theme(plot.title = element_text(size=16,hjust = 0.5))
plot(pp)
###################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_bar(stat = 'density')
pp <- pp + labs(title = 'Diferencias en tiempo con el modelo NMPR',
x = expression(Delta*T~('minutos')),y = 'Densidad de probabilidad')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + scale_x_continuous(limits=c(-100,100))
plot(pp)
###################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_bar(stat = 'density')
pp <- pp + labs(title = 'Diferencias en tiempo con el modelo NMPR',
x = expression(Delta*T~('minutos')),y = 'Densidad de probabilidad')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + scale_x_continuous(limits=c(-20,20))
plot(pp)
##########
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(y=diferencias,x=modelo,fill=modelo))
pp <- pp + stat_boxplot(geom = 'errorbar',width=0.2) + geom_boxplot()
pp <- pp + scale_y_continuous(breaks = seq(from=-5,to=5,by=0.5),limits = c(-5,5))
pp <- pp + labs(title='Diferencias con el modelo NMPR',
y=expression(Delta*H~"(cm)"),x='Modelos')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
plot(pp)
#######################
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 20)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
#######################
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 30)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
diferencias$diferencias
indc <- which(abs(diferencias$diferencias)>100)
indc <- which(abs(diferencias$diferencias)>100)
if (length(indc)>0) {
diferencias <- diferencias[-indc,]
}
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 30)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
#######################
indc <- which(abs(diferencias$diferencias)>100)
if (length(indc)>0) {
diferencias <- diferencias[-indc,]
}
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 30, binwidth = 5)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
#######################
indc <- which(abs(diferencias$diferencias)>100)
if (length(indc)>0) {
diferencias <- diferencias[-indc,]
}
png(width=1200,height=650,file=paste0(carpeta,lugar,'.png'))
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_histogram(colour='black',bins = 30)
pp <- pp + labs(title = paste0('Diferencias en altura con el modelo NMPR ',lugar),
x = expression(Delta*H~('cm')),y = 'Conteo')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + facet_wrap(modelo~.,ncol=2,nrow=1)
plot(pp)
dev.off()
###########
dif12 <- 60*(as.numeric(datos1$HOR1) - as.numeric(datos2$HOR1)) +
(as.numeric(datos1$MIN1) - as.numeric(datos2$MIN1))
dif13 <- 60*(as.numeric(datos1$HOR1) - as.numeric(datos3$HOR1[-368])) +
(as.numeric(datos1$MIN1) - as.numeric(datos3$MIN1))
dif23 <- 60*(as.numeric(datos2$HOR1) - as.numeric(datos3$HOR1)) +
(as.numeric(datos2$MIN1) - as.numeric(datos3$MIN1))
################################
diferencias <- data.frame( diferencias = c(dif12,dif13),
modelo = c(rep('Ttide',times=length(dif12)),
rep('THarmonics',times=length(dif13))))
##############################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(y=diferencias,x=modelo,fill=modelo))
pp <- pp + stat_boxplot(geom = 'errorbar',width=0.2) + geom_boxplot()
pp <- pp + scale_y_continuous(breaks = seq(from=-5,to=5,by=0.5),limits = c(-5,5))
pp <- pp+ labs(title='Diferencias en tiempo')
pp <- pp + theme(plot.title = element_text(size=16,hjust = 0.5))
plot(pp)
###################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_bar(stat = 'density')
pp <- pp + labs(title = 'Diferencias en tiempo con el modelo NMPR',
x = expression(Delta*T~('minutos')),y = 'Densidad de probabilidad')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + scale_x_continuous(limits=c(-20,20))
plot(pp)
##############################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(y=diferencias,x=modelo,fill=modelo))
pp <- pp + stat_boxplot(geom = 'errorbar',width=0.2) + geom_boxplot()
pp <- pp + scale_y_continuous(breaks = seq(from=-5,to=5,by=0.5),limits = c(-5,5))
pp <- pp+ labs(title='Diferencias en tiempo')
pp <- pp + theme(plot.title = element_text(size=16,hjust = 0.5))
plot(pp)
###################
windows(width=1200,height=650)
pp <- ggplot(data=diferencias,aes(x=diferencias,fill=modelo))
pp <- pp + geom_bar(stat = 'density')
pp <- pp + labs(title = 'Diferencias en tiempo con el modelo NMPR',
x = expression(Delta*T~('minutos')),y = 'Densidad de probabilidad')
pp <- pp + theme(plot.title = element_text(size=18,hjust = 0.5,face='bold'),
axis.title = element_text(size=14))
pp <- pp + scale_x_continuous(limits=c(-20,20))
plot(pp)
lista
source('E:/programasR/mareaISO2019.R')
source('E:/programasR/mareaISO2019.R')
source('E:/programasR/boletin/boletin_copernico_anm.R', encoding = 'UTF-8')
